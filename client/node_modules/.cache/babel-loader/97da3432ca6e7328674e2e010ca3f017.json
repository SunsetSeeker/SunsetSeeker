{"ast":null,"code":"import * as CommonSelectors from '../lib/common_selectors';\nimport mouseEventPoint from '../lib/mouse_event_point';\nimport createSupplementaryPoints from '../lib/create_supplementary_points';\nimport StringSet from '../lib/string_set';\nimport doubleClickZoom from '../lib/double_click_zoom';\nimport moveFeatures from '../lib/move_features';\nimport * as Constants from '../constants';\nvar SimpleSelect = {};\n\nSimpleSelect.onSetup = function (opts) {\n  var _this = this;\n\n  // turn the opts into state.\n  var state = {\n    dragMoveLocation: null,\n    boxSelectStartLocation: null,\n    boxSelectElement: undefined,\n    boxSelecting: false,\n    canBoxSelect: false,\n    dragMoving: false,\n    canDragMove: false,\n    initiallySelectedFeatureIds: opts.featureIds || []\n  };\n  this.setSelected(state.initiallySelectedFeatureIds.filter(function (id) {\n    return _this.getFeature(id) !== undefined;\n  }));\n  this.fireActionable();\n  this.setActionableState({\n    combineFeatures: true,\n    uncombineFeatures: true,\n    trash: true\n  });\n  return state;\n};\n\nSimpleSelect.fireUpdate = function () {\n  this.map.fire(Constants.events.UPDATE, {\n    action: Constants.updateActions.MOVE,\n    features: this.getSelected().map(function (f) {\n      return f.toGeoJSON();\n    })\n  });\n};\n\nSimpleSelect.fireActionable = function () {\n  var _this2 = this;\n\n  var selectedFeatures = this.getSelected();\n  var multiFeatures = selectedFeatures.filter(function (feature) {\n    return _this2.isInstanceOf('MultiFeature', feature);\n  });\n  var combineFeatures = false;\n\n  if (selectedFeatures.length > 1) {\n    combineFeatures = true;\n    var featureType = selectedFeatures[0].type.replace('Multi', '');\n    selectedFeatures.forEach(function (feature) {\n      if (feature.type.replace('Multi', '') !== featureType) {\n        combineFeatures = false;\n      }\n    });\n  }\n\n  var uncombineFeatures = multiFeatures.length > 0;\n  var trash = selectedFeatures.length > 0;\n  this.setActionableState({\n    combineFeatures: combineFeatures,\n    uncombineFeatures: uncombineFeatures,\n    trash: trash\n  });\n};\n\nSimpleSelect.getUniqueIds = function (allFeatures) {\n  if (!allFeatures.length) return [];\n  var ids = allFeatures.map(function (s) {\n    return s.properties.id;\n  }).filter(function (id) {\n    return id !== undefined;\n  }).reduce(function (memo, id) {\n    memo.add(id);\n    return memo;\n  }, new StringSet());\n  return ids.values();\n};\n\nSimpleSelect.stopExtendedInteractions = function (state) {\n  if (state.boxSelectElement) {\n    if (state.boxSelectElement.parentNode) state.boxSelectElement.parentNode.removeChild(state.boxSelectElement);\n    state.boxSelectElement = null;\n  }\n\n  this.map.dragPan.enable();\n  state.boxSelecting = false;\n  state.canBoxSelect = false;\n  state.dragMoving = false;\n  state.canDragMove = false;\n};\n\nSimpleSelect.onStop = function () {\n  doubleClickZoom.enable(this);\n};\n\nSimpleSelect.onMouseMove = function (state) {\n  // On mousemove that is not a drag, stop extended interactions.\n  // This is useful if you drag off the canvas, release the button,\n  // then move the mouse back over the canvas --- we don't allow the\n  // interaction to continue then, but we do let it continue if you held\n  // the mouse button that whole time\n  return this.stopExtendedInteractions(state);\n};\n\nSimpleSelect.onMouseOut = function (state) {\n  // As soon as you mouse leaves the canvas, update the feature\n  if (state.dragMoving) return this.fireUpdate();\n};\n\nSimpleSelect.onTap = SimpleSelect.onClick = function (state, e) {\n  // Click (with or without shift) on no feature\n  if (CommonSelectors.noTarget(e)) return this.clickAnywhere(state, e); // also tap\n\n  if (CommonSelectors.isOfMetaType(Constants.meta.VERTEX)(e)) return this.clickOnVertex(state, e); //tap\n\n  if (CommonSelectors.isFeature(e)) return this.clickOnFeature(state, e);\n};\n\nSimpleSelect.clickAnywhere = function (state) {\n  var _this3 = this;\n\n  // Clear the re-render selection\n  var wasSelected = this.getSelectedIds();\n\n  if (wasSelected.length) {\n    this.clearSelectedFeatures();\n    wasSelected.forEach(function (id) {\n      return _this3.doRender(id);\n    });\n  }\n\n  doubleClickZoom.enable(this);\n  this.stopExtendedInteractions(state);\n};\n\nSimpleSelect.clickOnVertex = function (state, e) {\n  // Enter direct select mode\n  this.changeMode(Constants.modes.DIRECT_SELECT, {\n    featureId: e.featureTarget.properties.parent,\n    coordPath: e.featureTarget.properties.coord_path,\n    startPos: e.lngLat\n  });\n  this.updateUIClasses({\n    mouse: Constants.cursors.MOVE\n  });\n};\n\nSimpleSelect.startOnActiveFeature = function (state, e) {\n  // Stop any already-underway extended interactions\n  this.stopExtendedInteractions(state); // Disable map.dragPan immediately so it can't start\n\n  this.map.dragPan.disable(); // Re-render it and enable drag move\n\n  this.doRender(e.featureTarget.properties.id); // Set up the state for drag moving\n\n  state.canDragMove = true;\n  state.dragMoveLocation = e.lngLat;\n};\n\nSimpleSelect.clickOnFeature = function (state, e) {\n  var _this4 = this;\n\n  // Stop everything\n  doubleClickZoom.disable(this);\n  this.stopExtendedInteractions(state);\n  var isShiftClick = CommonSelectors.isShiftDown(e);\n  var selectedFeatureIds = this.getSelectedIds();\n  var featureId = e.featureTarget.properties.id;\n  var isFeatureSelected = this.isSelected(featureId); // Click (without shift) on any selected feature but a point\n\n  if (!isShiftClick && isFeatureSelected && this.getFeature(featureId).type !== Constants.geojsonTypes.POINT) {\n    // Enter direct select mode\n    return this.changeMode(Constants.modes.DIRECT_SELECT, {\n      featureId: featureId\n    });\n  } // Shift-click on a selected feature\n\n\n  if (isFeatureSelected && isShiftClick) {\n    // Deselect it\n    this.deselect(featureId);\n    this.updateUIClasses({\n      mouse: Constants.cursors.POINTER\n    });\n\n    if (selectedFeatureIds.length === 1) {\n      doubleClickZoom.enable(this);\n    } // Shift-click on an unselected feature\n\n  } else if (!isFeatureSelected && isShiftClick) {\n    // Add it to the selection\n    this.select(featureId);\n    this.updateUIClasses({\n      mouse: Constants.cursors.MOVE\n    }); // Click (without shift) on an unselected feature\n  } else if (!isFeatureSelected && !isShiftClick) {\n    // Make it the only selected feature\n    selectedFeatureIds.forEach(function (id) {\n      return _this4.doRender(id);\n    });\n    this.setSelected(featureId);\n    this.updateUIClasses({\n      mouse: Constants.cursors.MOVE\n    });\n  } // No matter what, re-render the clicked feature\n\n\n  this.doRender(featureId);\n};\n\nSimpleSelect.onMouseDown = function (state, e) {\n  if (CommonSelectors.isActiveFeature(e)) return this.startOnActiveFeature(state, e);\n  if (this.drawConfig.boxSelect && CommonSelectors.isShiftMousedown(e)) return this.startBoxSelect(state, e);\n};\n\nSimpleSelect.startBoxSelect = function (state, e) {\n  this.stopExtendedInteractions(state);\n  this.map.dragPan.disable(); // Enable box select\n\n  state.boxSelectStartLocation = mouseEventPoint(e.originalEvent, this.map.getContainer());\n  state.canBoxSelect = true;\n};\n\nSimpleSelect.onTouchStart = function (state, e) {\n  if (CommonSelectors.isActiveFeature(e)) return this.startOnActiveFeature(state, e);\n};\n\nSimpleSelect.onDrag = function (state, e) {\n  if (state.canDragMove) return this.dragMove(state, e);\n  if (this.drawConfig.boxSelect && state.canBoxSelect) return this.whileBoxSelect(state, e);\n};\n\nSimpleSelect.whileBoxSelect = function (state, e) {\n  state.boxSelecting = true;\n  this.updateUIClasses({\n    mouse: Constants.cursors.ADD\n  }); // Create the box node if it doesn't exist\n\n  if (!state.boxSelectElement) {\n    state.boxSelectElement = document.createElement('div');\n    state.boxSelectElement.classList.add(Constants.classes.BOX_SELECT);\n    this.map.getContainer().appendChild(state.boxSelectElement);\n  } // Adjust the box node's width and xy position\n\n\n  var current = mouseEventPoint(e.originalEvent, this.map.getContainer());\n  var minX = Math.min(state.boxSelectStartLocation.x, current.x);\n  var maxX = Math.max(state.boxSelectStartLocation.x, current.x);\n  var minY = Math.min(state.boxSelectStartLocation.y, current.y);\n  var maxY = Math.max(state.boxSelectStartLocation.y, current.y);\n  var translateValue = \"translate(\".concat(minX, \"px, \").concat(minY, \"px)\");\n  state.boxSelectElement.style.transform = translateValue;\n  state.boxSelectElement.style.WebkitTransform = translateValue;\n  state.boxSelectElement.style.width = \"\".concat(maxX - minX, \"px\");\n  state.boxSelectElement.style.height = \"\".concat(maxY - minY, \"px\");\n};\n\nSimpleSelect.dragMove = function (state, e) {\n  // Dragging when drag move is enabled\n  state.dragMoving = true;\n  e.originalEvent.stopPropagation();\n  var delta = {\n    lng: e.lngLat.lng - state.dragMoveLocation.lng,\n    lat: e.lngLat.lat - state.dragMoveLocation.lat\n  };\n  moveFeatures(this.getSelected(), delta);\n  state.dragMoveLocation = e.lngLat;\n};\n\nSimpleSelect.onMouseUp = function (state, e) {\n  var _this5 = this;\n\n  // End any extended interactions\n  if (state.dragMoving) {\n    this.fireUpdate();\n  } else if (state.boxSelecting) {\n    var bbox = [state.boxSelectStartLocation, mouseEventPoint(e.originalEvent, this.map.getContainer())];\n    var featuresInBox = this.featuresAt(null, bbox, 'click');\n    var idsToSelect = this.getUniqueIds(featuresInBox).filter(function (id) {\n      return !_this5.isSelected(id);\n    });\n\n    if (idsToSelect.length) {\n      this.select(idsToSelect);\n      idsToSelect.forEach(function (id) {\n        return _this5.doRender(id);\n      });\n      this.updateUIClasses({\n        mouse: Constants.cursors.MOVE\n      });\n    }\n  }\n\n  this.stopExtendedInteractions(state);\n};\n\nSimpleSelect.toDisplayFeatures = function (state, geojson, display) {\n  geojson.properties.active = this.isSelected(geojson.properties.id) ? Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE;\n  display(geojson);\n  this.fireActionable();\n  if (geojson.properties.active !== Constants.activeStates.ACTIVE || geojson.geometry.type === Constants.geojsonTypes.POINT) return;\n  createSupplementaryPoints(geojson).forEach(display);\n};\n\nSimpleSelect.onTrash = function () {\n  this.deleteFeature(this.getSelectedIds());\n  this.fireActionable();\n};\n\nSimpleSelect.onCombineFeatures = function () {\n  var selectedFeatures = this.getSelected();\n  if (selectedFeatures.length === 0 || selectedFeatures.length < 2) return;\n  var coordinates = [],\n      featuresCombined = [];\n  var featureType = selectedFeatures[0].type.replace('Multi', '');\n\n  for (var i = 0; i < selectedFeatures.length; i++) {\n    var feature = selectedFeatures[i];\n\n    if (feature.type.replace('Multi', '') !== featureType) {\n      return;\n    }\n\n    if (feature.type.includes('Multi')) {\n      feature.getCoordinates().forEach(function (subcoords) {\n        coordinates.push(subcoords);\n      });\n    } else {\n      coordinates.push(feature.getCoordinates());\n    }\n\n    featuresCombined.push(feature.toGeoJSON());\n  }\n\n  if (featuresCombined.length > 1) {\n    var multiFeature = this.newFeature({\n      type: Constants.geojsonTypes.FEATURE,\n      properties: featuresCombined[0].properties,\n      geometry: {\n        type: \"Multi\".concat(featureType),\n        coordinates: coordinates\n      }\n    });\n    this.addFeature(multiFeature);\n    this.deleteFeature(this.getSelectedIds(), {\n      silent: true\n    });\n    this.setSelected([multiFeature.id]);\n    this.map.fire(Constants.events.COMBINE_FEATURES, {\n      createdFeatures: [multiFeature.toGeoJSON()],\n      deletedFeatures: featuresCombined\n    });\n  }\n\n  this.fireActionable();\n};\n\nSimpleSelect.onUncombineFeatures = function () {\n  var _this6 = this;\n\n  var selectedFeatures = this.getSelected();\n  if (selectedFeatures.length === 0) return;\n  var createdFeatures = [];\n  var featuresUncombined = [];\n\n  var _loop = function _loop(i) {\n    var feature = selectedFeatures[i];\n\n    if (_this6.isInstanceOf('MultiFeature', feature)) {\n      feature.getFeatures().forEach(function (subFeature) {\n        _this6.addFeature(subFeature);\n\n        subFeature.properties = feature.properties;\n        createdFeatures.push(subFeature.toGeoJSON());\n\n        _this6.select([subFeature.id]);\n      });\n\n      _this6.deleteFeature(feature.id, {\n        silent: true\n      });\n\n      featuresUncombined.push(feature.toGeoJSON());\n    }\n  };\n\n  for (var i = 0; i < selectedFeatures.length; i++) {\n    _loop(i);\n  }\n\n  if (createdFeatures.length > 1) {\n    this.map.fire(Constants.events.UNCOMBINE_FEATURES, {\n      createdFeatures: createdFeatures,\n      deletedFeatures: featuresUncombined\n    });\n  }\n\n  this.fireActionable();\n};\n\nexport default SimpleSelect;","map":{"version":3,"sources":["/Users/gabrielmaldonadopalladini/Desktop/Ironhack/Project3/SunsetSeeker/client/node_modules/@mapbox/mapbox-gl-draw/src/modes/simple_select.js"],"names":["CommonSelectors","mouseEventPoint","createSupplementaryPoints","StringSet","doubleClickZoom","moveFeatures","Constants","SimpleSelect","onSetup","opts","state","dragMoveLocation","boxSelectStartLocation","boxSelectElement","undefined","boxSelecting","canBoxSelect","dragMoving","canDragMove","initiallySelectedFeatureIds","featureIds","setSelected","filter","id","getFeature","fireActionable","setActionableState","combineFeatures","uncombineFeatures","trash","fireUpdate","map","fire","events","UPDATE","action","updateActions","MOVE","features","getSelected","f","toGeoJSON","selectedFeatures","multiFeatures","feature","isInstanceOf","length","featureType","type","replace","forEach","getUniqueIds","allFeatures","ids","s","properties","reduce","memo","add","values","stopExtendedInteractions","parentNode","removeChild","dragPan","enable","onStop","onMouseMove","onMouseOut","onTap","onClick","e","noTarget","clickAnywhere","isOfMetaType","meta","VERTEX","clickOnVertex","isFeature","clickOnFeature","wasSelected","getSelectedIds","clearSelectedFeatures","doRender","changeMode","modes","DIRECT_SELECT","featureId","featureTarget","parent","coordPath","coord_path","startPos","lngLat","updateUIClasses","mouse","cursors","startOnActiveFeature","disable","isShiftClick","isShiftDown","selectedFeatureIds","isFeatureSelected","isSelected","geojsonTypes","POINT","deselect","POINTER","select","onMouseDown","isActiveFeature","drawConfig","boxSelect","isShiftMousedown","startBoxSelect","originalEvent","getContainer","onTouchStart","onDrag","dragMove","whileBoxSelect","ADD","document","createElement","classList","classes","BOX_SELECT","appendChild","current","minX","Math","min","x","maxX","max","minY","y","maxY","translateValue","style","transform","WebkitTransform","width","height","stopPropagation","delta","lng","lat","onMouseUp","bbox","featuresInBox","featuresAt","idsToSelect","toDisplayFeatures","geojson","display","active","activeStates","ACTIVE","INACTIVE","geometry","onTrash","deleteFeature","onCombineFeatures","coordinates","featuresCombined","i","includes","getCoordinates","subcoords","push","multiFeature","newFeature","FEATURE","addFeature","silent","COMBINE_FEATURES","createdFeatures","deletedFeatures","onUncombineFeatures","featuresUncombined","getFeatures","subFeature","UNCOMBINE_FEATURES"],"mappings":"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","sourcesContent":["import * as CommonSelectors from '../lib/common_selectors';\nimport mouseEventPoint from '../lib/mouse_event_point';\nimport createSupplementaryPoints from '../lib/create_supplementary_points';\nimport StringSet from '../lib/string_set';\nimport doubleClickZoom from '../lib/double_click_zoom';\nimport moveFeatures from '../lib/move_features';\nimport * as Constants from '../constants';\n\nconst SimpleSelect = {};\n\nSimpleSelect.onSetup = function(opts) {\n  // turn the opts into state.\n  const state = {\n    dragMoveLocation: null,\n    boxSelectStartLocation: null,\n    boxSelectElement: undefined,\n    boxSelecting: false,\n    canBoxSelect: false,\n    dragMoving: false,\n    canDragMove: false,\n    initiallySelectedFeatureIds: opts.featureIds || []\n  };\n\n  this.setSelected(state.initiallySelectedFeatureIds.filter(id => this.getFeature(id) !== undefined));\n  this.fireActionable();\n\n  this.setActionableState({\n    combineFeatures: true,\n    uncombineFeatures: true,\n    trash: true\n  });\n\n  return state;\n};\n\nSimpleSelect.fireUpdate = function() {\n  this.map.fire(Constants.events.UPDATE, {\n    action: Constants.updateActions.MOVE,\n    features: this.getSelected().map(f => f.toGeoJSON())\n  });\n};\n\nSimpleSelect.fireActionable = function() {\n  const selectedFeatures = this.getSelected();\n\n  const multiFeatures = selectedFeatures.filter(\n    feature => this.isInstanceOf('MultiFeature', feature)\n  );\n\n  let combineFeatures = false;\n\n  if (selectedFeatures.length > 1) {\n    combineFeatures = true;\n    const featureType = selectedFeatures[0].type.replace('Multi', '');\n    selectedFeatures.forEach((feature) => {\n      if (feature.type.replace('Multi', '') !== featureType) {\n        combineFeatures = false;\n      }\n    });\n  }\n\n  const uncombineFeatures = multiFeatures.length > 0;\n  const trash = selectedFeatures.length > 0;\n\n  this.setActionableState({\n    combineFeatures, uncombineFeatures, trash\n  });\n};\n\nSimpleSelect.getUniqueIds = function(allFeatures) {\n  if (!allFeatures.length) return [];\n  const ids = allFeatures.map(s => s.properties.id)\n    .filter(id => id !== undefined)\n    .reduce((memo, id) => {\n      memo.add(id);\n      return memo;\n    }, new StringSet());\n\n  return ids.values();\n};\n\nSimpleSelect.stopExtendedInteractions = function(state) {\n  if (state.boxSelectElement) {\n    if (state.boxSelectElement.parentNode) state.boxSelectElement.parentNode.removeChild(state.boxSelectElement);\n    state.boxSelectElement = null;\n  }\n\n  this.map.dragPan.enable();\n\n  state.boxSelecting = false;\n  state.canBoxSelect = false;\n  state.dragMoving = false;\n  state.canDragMove = false;\n};\n\nSimpleSelect.onStop = function() {\n  doubleClickZoom.enable(this);\n};\n\nSimpleSelect.onMouseMove = function(state) {\n  // On mousemove that is not a drag, stop extended interactions.\n  // This is useful if you drag off the canvas, release the button,\n  // then move the mouse back over the canvas --- we don't allow the\n  // interaction to continue then, but we do let it continue if you held\n  // the mouse button that whole time\n  return this.stopExtendedInteractions(state);\n};\n\nSimpleSelect.onMouseOut = function(state) {\n  // As soon as you mouse leaves the canvas, update the feature\n  if (state.dragMoving) return this.fireUpdate();\n};\n\nSimpleSelect.onTap = SimpleSelect.onClick = function(state, e) {\n  // Click (with or without shift) on no feature\n  if (CommonSelectors.noTarget(e)) return this.clickAnywhere(state, e); // also tap\n  if (CommonSelectors.isOfMetaType(Constants.meta.VERTEX)(e)) return this.clickOnVertex(state, e); //tap\n  if (CommonSelectors.isFeature(e)) return this.clickOnFeature(state, e);\n};\n\nSimpleSelect.clickAnywhere = function (state) {\n  // Clear the re-render selection\n  const wasSelected = this.getSelectedIds();\n  if (wasSelected.length) {\n    this.clearSelectedFeatures();\n    wasSelected.forEach(id => this.doRender(id));\n  }\n  doubleClickZoom.enable(this);\n  this.stopExtendedInteractions(state);\n};\n\nSimpleSelect.clickOnVertex = function(state, e) {\n  // Enter direct select mode\n  this.changeMode(Constants.modes.DIRECT_SELECT, {\n    featureId: e.featureTarget.properties.parent,\n    coordPath: e.featureTarget.properties.coord_path,\n    startPos: e.lngLat\n  });\n  this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n};\n\nSimpleSelect.startOnActiveFeature = function(state, e) {\n  // Stop any already-underway extended interactions\n  this.stopExtendedInteractions(state);\n\n  // Disable map.dragPan immediately so it can't start\n  this.map.dragPan.disable();\n\n  // Re-render it and enable drag move\n  this.doRender(e.featureTarget.properties.id);\n\n  // Set up the state for drag moving\n  state.canDragMove = true;\n  state.dragMoveLocation = e.lngLat;\n};\n\nSimpleSelect.clickOnFeature = function(state, e) {\n  // Stop everything\n  doubleClickZoom.disable(this);\n  this.stopExtendedInteractions(state);\n\n  const isShiftClick = CommonSelectors.isShiftDown(e);\n  const selectedFeatureIds = this.getSelectedIds();\n  const featureId = e.featureTarget.properties.id;\n  const isFeatureSelected = this.isSelected(featureId);\n\n  // Click (without shift) on any selected feature but a point\n  if (!isShiftClick && isFeatureSelected && this.getFeature(featureId).type !== Constants.geojsonTypes.POINT) {\n    // Enter direct select mode\n    return this.changeMode(Constants.modes.DIRECT_SELECT, {\n      featureId\n    });\n  }\n\n  // Shift-click on a selected feature\n  if (isFeatureSelected && isShiftClick) {\n    // Deselect it\n    this.deselect(featureId);\n    this.updateUIClasses({ mouse: Constants.cursors.POINTER });\n    if (selectedFeatureIds.length === 1) {\n      doubleClickZoom.enable(this);\n    }\n  // Shift-click on an unselected feature\n  } else if (!isFeatureSelected && isShiftClick) {\n    // Add it to the selection\n    this.select(featureId);\n    this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n  // Click (without shift) on an unselected feature\n  } else if (!isFeatureSelected && !isShiftClick) {\n    // Make it the only selected feature\n    selectedFeatureIds.forEach(id => this.doRender(id));\n    this.setSelected(featureId);\n    this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n  }\n\n  // No matter what, re-render the clicked feature\n  this.doRender(featureId);\n};\n\nSimpleSelect.onMouseDown = function(state, e) {\n  if (CommonSelectors.isActiveFeature(e)) return this.startOnActiveFeature(state, e);\n  if (this.drawConfig.boxSelect && CommonSelectors.isShiftMousedown(e)) return this.startBoxSelect(state, e);\n};\n\nSimpleSelect.startBoxSelect = function(state, e) {\n  this.stopExtendedInteractions(state);\n  this.map.dragPan.disable();\n  // Enable box select\n  state.boxSelectStartLocation = mouseEventPoint(e.originalEvent, this.map.getContainer());\n  state.canBoxSelect = true;\n};\n\nSimpleSelect.onTouchStart = function(state, e) {\n  if (CommonSelectors.isActiveFeature(e)) return this.startOnActiveFeature(state, e);\n};\n\nSimpleSelect.onDrag = function(state, e) {\n  if (state.canDragMove) return this.dragMove(state, e);\n  if (this.drawConfig.boxSelect && state.canBoxSelect) return this.whileBoxSelect(state, e);\n};\n\nSimpleSelect.whileBoxSelect = function(state, e) {\n  state.boxSelecting = true;\n  this.updateUIClasses({ mouse: Constants.cursors.ADD });\n\n  // Create the box node if it doesn't exist\n  if (!state.boxSelectElement) {\n    state.boxSelectElement = document.createElement('div');\n    state.boxSelectElement.classList.add(Constants.classes.BOX_SELECT);\n    this.map.getContainer().appendChild(state.boxSelectElement);\n  }\n\n  // Adjust the box node's width and xy position\n  const current = mouseEventPoint(e.originalEvent, this.map.getContainer());\n  const minX = Math.min(state.boxSelectStartLocation.x, current.x);\n  const maxX = Math.max(state.boxSelectStartLocation.x, current.x);\n  const minY = Math.min(state.boxSelectStartLocation.y, current.y);\n  const maxY = Math.max(state.boxSelectStartLocation.y, current.y);\n  const translateValue = `translate(${minX}px, ${minY}px)`;\n  state.boxSelectElement.style.transform = translateValue;\n  state.boxSelectElement.style.WebkitTransform = translateValue;\n  state.boxSelectElement.style.width = `${maxX - minX}px`;\n  state.boxSelectElement.style.height = `${maxY - minY}px`;\n};\n\nSimpleSelect.dragMove = function(state, e) {\n  // Dragging when drag move is enabled\n  state.dragMoving = true;\n  e.originalEvent.stopPropagation();\n\n  const delta = {\n    lng: e.lngLat.lng - state.dragMoveLocation.lng,\n    lat: e.lngLat.lat - state.dragMoveLocation.lat\n  };\n\n  moveFeatures(this.getSelected(), delta);\n\n  state.dragMoveLocation = e.lngLat;\n};\n\nSimpleSelect.onMouseUp = function(state, e) {\n  // End any extended interactions\n  if (state.dragMoving) {\n    this.fireUpdate();\n  } else if (state.boxSelecting) {\n    const bbox = [\n      state.boxSelectStartLocation,\n      mouseEventPoint(e.originalEvent, this.map.getContainer())\n    ];\n    const featuresInBox = this.featuresAt(null, bbox, 'click');\n    const idsToSelect = this.getUniqueIds(featuresInBox)\n      .filter(id => !this.isSelected(id));\n\n    if (idsToSelect.length) {\n      this.select(idsToSelect);\n      idsToSelect.forEach(id => this.doRender(id));\n      this.updateUIClasses({ mouse: Constants.cursors.MOVE });\n    }\n  }\n  this.stopExtendedInteractions(state);\n};\n\nSimpleSelect.toDisplayFeatures = function(state, geojson, display) {\n  geojson.properties.active = (this.isSelected(geojson.properties.id)) ?\n    Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE;\n  display(geojson);\n  this.fireActionable();\n  if (geojson.properties.active !== Constants.activeStates.ACTIVE ||\n    geojson.geometry.type === Constants.geojsonTypes.POINT) return;\n  createSupplementaryPoints(geojson).forEach(display);\n};\n\nSimpleSelect.onTrash = function() {\n  this.deleteFeature(this.getSelectedIds());\n  this.fireActionable();\n};\n\nSimpleSelect.onCombineFeatures = function() {\n  const selectedFeatures = this.getSelected();\n\n  if (selectedFeatures.length === 0 || selectedFeatures.length < 2) return;\n\n  const coordinates = [], featuresCombined = [];\n  const featureType = selectedFeatures[0].type.replace('Multi', '');\n\n  for (let i = 0; i < selectedFeatures.length; i++) {\n    const feature = selectedFeatures[i];\n\n    if (feature.type.replace('Multi', '') !== featureType) {\n      return;\n    }\n    if (feature.type.includes('Multi')) {\n      feature.getCoordinates().forEach((subcoords) => {\n        coordinates.push(subcoords);\n      });\n    } else {\n      coordinates.push(feature.getCoordinates());\n    }\n\n    featuresCombined.push(feature.toGeoJSON());\n  }\n\n  if (featuresCombined.length > 1) {\n    const multiFeature = this.newFeature({\n      type: Constants.geojsonTypes.FEATURE,\n      properties: featuresCombined[0].properties,\n      geometry: {\n        type: `Multi${featureType}`,\n        coordinates\n      }\n    });\n\n    this.addFeature(multiFeature);\n    this.deleteFeature(this.getSelectedIds(), { silent: true });\n    this.setSelected([multiFeature.id]);\n\n    this.map.fire(Constants.events.COMBINE_FEATURES, {\n      createdFeatures: [multiFeature.toGeoJSON()],\n      deletedFeatures: featuresCombined\n    });\n  }\n  this.fireActionable();\n};\n\nSimpleSelect.onUncombineFeatures = function() {\n  const selectedFeatures = this.getSelected();\n  if (selectedFeatures.length === 0) return;\n\n  const createdFeatures = [];\n  const featuresUncombined = [];\n\n  for (let i = 0; i < selectedFeatures.length; i++) {\n    const feature = selectedFeatures[i];\n\n    if (this.isInstanceOf('MultiFeature', feature)) {\n      feature.getFeatures().forEach((subFeature) => {\n        this.addFeature(subFeature);\n        subFeature.properties = feature.properties;\n        createdFeatures.push(subFeature.toGeoJSON());\n        this.select([subFeature.id]);\n      });\n      this.deleteFeature(feature.id, { silent: true });\n      featuresUncombined.push(feature.toGeoJSON());\n    }\n  }\n\n  if (createdFeatures.length > 1) {\n    this.map.fire(Constants.events.UNCOMBINE_FEATURES, {\n      createdFeatures,\n      deletedFeatures: featuresUncombined\n    });\n  }\n  this.fireActionable();\n};\n\nexport default SimpleSelect;\n"]},"metadata":{},"sourceType":"module"}